<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ElectricalFlo 3D — Shop</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
  <div class="brandWrap">
    <img src="images/logo.png" alt="ElectricalFlo 3D Logo" class="logo" />
    <div class="brand">
      <h1>ElectricalFlo 3D</h1>
      <p>3D printed gear • custom orders welcome</p>
    </div>
  </div>

  <!-- ONLY Cart button on the page -->
  <button class="cartBtn" id="openCartBtn" type="button">
    Cart <span class="pill" id="cartCount">0</span>
  </button>
</header>

<!-- ================= MAIN ================= -->
<main class="wrap">
  <section class="toolbar">
    <input id="search" placeholder="Search items…" />
    <select id="sort">
      <option value="featured">Sort: Featured</option>
      <option value="price_asc">Price: Low → High</option>
      <option value="price_desc">Price: High → Low</option>
      <option value="name_asc">Name: A → Z</option>
    </select>
  </section>

  <section class="grid" id="grid"></section>
</main>

<!-- ================= CART DRAWER ================= -->
<aside class="drawer" id="drawer" aria-hidden="true">
  <div class="drawerHeader">
    <h2>Your Cart</h2>
    <button class="iconBtn" id="closeCartBtn" type="button">✕</button>
  </div>

  <div class="drawerBody" id="cartItems"></div>

  <div class="drawerFooter">
    <div class="totalRow">
      <span>Subtotal</span>
      <strong id="subtotal">$0.00</strong>
    </div>

    <label class="field">
      <span>Your name (optional)</span>
      <input id="customerName" />
    </label>

    <label class="field">
      <span>Notes (colors, callsign, etc.)</span>
      <textarea id="orderNotes" rows="3"></textarea>
    </label>

    <label class="field">
      <span>Preferred payment method</span>
      <select id="paymentMethod">
        <option value="PayPal">PayPal</option>
        <option value="Venmo">Venmo</option>
        <option value="Zelle">Zelle</option>
      </select>
    </label>

    <label class="field checkbox">
      <input type="checkbox" id="includeShippingNow" />
      <span>Include shipping address now (optional)</span>
    </label>

    <label class="field" id="shippingWrap" style="display:none">
      <span>Shipping address</span>
      <textarea id="shippingAddress" rows="3"></textarea>
    </label>

    <button class="primary" id="emailCheckoutBtn" type="button">
      Email Order for Payment Info
    </button>

    <button class="ghost" id="clearCartBtn" type="button">
      Clear cart
    </button>
  </div>
</aside>

<div class="backdrop" id="backdrop" hidden></div>

<!-- ================= SCRIPT ================= -->
<script>
const EMAIL_TO = "flores@n2cfx.com";
const EMAIL_SUBJECT_PREFIX = "ElectricalFlo 3D Order";

let PRODUCTS = [];
let cart = JSON.parse(localStorage.getItem("cart") || "{}");

const money = n => `$${Number(n).toFixed(2)}`;

function wireShippingToggle(){
  const cb = document.getElementById("includeShippingNow");
  const wrap = document.getElementById("shippingWrap");
  if (!cb || !wrap) return;
  cb.addEventListener("change", () => {
    wrap.style.display = cb.checked ? "block" : "none";
  });
}

function saveCart(){
  localStorage.setItem("cart", JSON.stringify(cart));
  document.getElementById("cartCount").textContent =
    Object.values(cart).reduce((a,b)=>a+b,0);
}

function addToCart(id){
  cart[id] = (cart[id] || 0) + 1;
  saveCart();
  renderCart();
}

function clearCart(){
  cart = {};
  saveCart();
  renderCart();
}

function renderProducts(){
  const grid = document.getElementById("grid");
  grid.innerHTML = PRODUCTS.map(p => `
    <article class="card">
      <div class="thumb">
        <img src="${p.image}" alt="${p.name}">
      </div>
      <div class="cardBody">
        <h3>${p.name}</h3>
        <span class="price">${money(p.price)}</span>
        <button class="primary" onclick="addToCart('${p.id}')">Add to cart</button>
      </div>
    </article>
  `).join("");
}

function renderCart(){
  const box = document.getElementById("cartItems");
  const items = Object.entries(cart).map(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return null;
    return {p,qty,line:p.price*qty};
  }).filter(Boolean);

  if(!items.length){
    box.innerHTML = "<p class='empty'>Your cart is empty.</p>";
    document.getElementById("subtotal").textContent = money(0);
    return;
  }

  box.innerHTML = items.map(i=>`
    <div class="cartRow">
      <strong>${i.p.name}</strong> × ${i.qty}
    </div>
  `).join("");

  document.getElementById("subtotal").textContent =
    money(items.reduce((a,b)=>a+b.line,0));
}

function emailCheckout(){
  if(!Object.keys(cart).length) return;
  const body = encodeURIComponent("Order request from ElectricalFlo3D site");
  window.location.href =
    `mailto:${EMAIL_TO}?subject=${EMAIL_SUBJECT_PREFIX}&body=${body}`;
}

function openDrawer(){
  drawer.classList.add("open");
  backdrop.hidden = false;
  renderCart();
}

function closeDrawer(){
  drawer.classList.remove("open");
  backdrop.hidden = true;
}

async function init(){
  PRODUCTS = await (await fetch("products.json")).json();

  openCartBtn.onclick = openDrawer;
  closeCartBtn.onclick = closeDrawer;
  backdrop.onclick = closeDrawer;
  emailCheckoutBtn.onclick = emailCheckout;
  clearCartBtn.onclick = clearCart;

  wireShippingToggle();
  saveCart();
  renderProducts();
}

init();
</script>

</body>
</html>
